## Codebase Patterns
- This is a Python scraper project in the /scraper directory
- Main scraping logic in scraper/src/scraper.py (CarnaMapaScraper class)
- Geocoding in scraper/src/geocoder.py (GeocodingService class with caching)
- City configs in scraper/src/config.py (CITIES dict with name, url, slug)
- Output files in scraper/output/{city-slug}.json (GeoJSON format)
- Cache stored in scraper/cache/geocoding_cache.json
- Uses geopy library for geocoding (supports Nominatim and GoogleV3)
- Uses beautifulsoup4 for HTML parsing
- Uses requests for HTTP
- Environment variables loaded via python-dotenv
- TypeScript checking equivalent: python -m py_compile <file>
- 9 cities configured: sao-paulo, rio-de-janeiro, belo-horizonte, salvador, florianopolis, recife-olinda, brasilia, porto-alegre, fortaleza

- Use python3 (not python) for Python commands on macOS
- Typecheck for Python files: python3 -m py_compile <file>

---

## 2026-01-28 - US-001
- What was implemented: Added Google Maps API configuration support for geocoding fallback
- Files changed:
  - scraper/.env.example (updated with GOOGLE_MAPS_API_KEY, GEOCODING_GOOGLE_ENABLED, GEOCODING_NOMINATIM_CONCURRENCY, GEOCODING_GOOGLE_CONCURRENCY)
  - scraper/src/config.py (added environment variable loading with get_bool_env and get_int_env helpers)
- **Learnings for future iterations:**
  - python-dotenv load_dotenv() should be called at module import time in config.py
  - Use helper functions for type conversion from env vars (bool and int)
  - Boolean env vars accept 'true', '1', 'yes', 'on' (case-insensitive)
  - Default values: GEOCODING_GOOGLE_ENABLED=True, NOMINATIM_CONCURRENCY=1, GOOGLE_CONCURRENCY=10
---

## 2026-01-28 - US-002
- What was implemented: Created address normalization module with two functions for improving geocoding success
- Files changed:
  - scraper/src/address_normalizer.py (new file)
- **Learnings for future iterations:**
  - normalize_address() handles: parenthetical notes, zip codes (5-8 digits), 'Brasil' suffix, 's/n' (sem número), 'Centro Histórico' -> 'Centro'
  - extract_landmark() can extract landmarks like 'Praça da Sé', 'Parque Ibirapuera', etc. for fallback geocoding queries
  - Brazilian zip code formats: 04784-145, 04784145, 04784 145 (5 digits + optional separator + 3 digits)
  - Common patterns removed: 'próximo', 'perto', 'ao lado', 'em frente', 'esquina'
---

